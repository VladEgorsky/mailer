# Тестовое задание №5

На вакансию Middle PHP-разработчик (Yii2)

**Почтовый клиент на Yii2 для работы с почтой через Gmail или Yandex** 

[https://github.com/bmbullet/webdev-test-tasks/blob/master/middle/web-dev-php-middle-005.md](https://github.com/bmbullet/webdev-test-tasks/blob/master/middle/web-dev-php-middle-005.md)

Использованы расширения:

"php-imap/php-imap" - [https://github.com/barbushin/php-imap](https://github.com/barbushin/php-imap)


## Основной компонент: app\components\Mailer.php
Расширяет компонент yii\swiftmailer\Mailer и назначается как компонент приложения Yii::$app->mailer (удобно использовать как хранилище для глобальных переменных).

На данном этапе БД не используется, все необходимые данные хранятся в модели app\models\Provider (name, server, smtpServer, imalServer ... Всё задано хардкодом прямо в классе) и в сессиях.

## Алгоритм работы:
1. В окно Аторизации вводим Провайдера, почтовый адрес и пароль.
2. Компонент Mailer используя IMAP-функции выбирает данные по самому почтовому ящику (Driver, Mailbox, Number of mails ...) и данные по каждому сообщению в папке Входящие (subject, from, date, флаги просмотра, черновика, удаления ...). 
3. Если доступ по Логину-Паролю успешный, то выполняется Yii::$app->user->login, дальнейший доступ к просмотру и созданию сообщений только для залогиненных пользователей.
4. Все эти данные (Авторизации, по ящику и по все сообщениям) сохраняем в свойствах объекта Yii::$app->mailer и в сессиях. При создании приложения в конструкторе значения свойств восстанавливаются из сессии.
5. Тело сообщения для просмотра и загрузка приаттаченных файлов выполняются функцией Yii::$app->mailer->getMessageBody(). Файлы скачиваются в директорию /web/attachments.
6. Отправка сообщений выполняется функцией Yii::$app->mailer->send() через Smtp, необходимые данные храним в app\models\Provider

## Примечание:
- Пытался выложить демо у своего хостера, но при попытках получить данные с почтовых серверов скрипт отваливается в ошибкой 502 (upstream prematurely closed connection while reading response header from upstream). Видимо настройки хостинга не позволяют. На локалке все работает без проблем.
